<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDCP Ciphering - Interactive 3GPP 4G/5G Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --neon-blue: #00d4ff;
            --neon-purple: #a855f7;
            --neon-pink: #ec4899;
            --neon-green: #10b981;
            --dark-bg: #0a0e27;
            --card-bg: rgba(30, 41, 59, 0.6);
            --glass-bg: rgba(51, 65, 85, 0.4);
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1419 100%);
            color: #e0e0e0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Animated Background Particles */
        .background-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--neon-blue);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(50px, -50px); }
            50% { transform: translate(-30px, 30px); }
            75% { transform: translate(30px, 50px); }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(168, 85, 247, 0.15) 100%);
            border-radius: 25px;
            border: 1px solid rgba(99, 102, 241, 0.4);
            margin-bottom: 50px;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.2);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(0, 212, 255, 0.1) 50%, transparent 70%);
            animation: headerShimmer 6s infinite linear;
        }

        @keyframes headerShimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        h1 {
            font-size: 3.5em;
            background: linear-gradient(135deg, #00d4ff 0%, #a855f7 50%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            font-weight: 800;
            text-shadow: 0 0 40px rgba(0, 212, 255, 0.5);
        }

        .subtitle {
            color: #9ca3af;
            font-size: 1.3em;
            position: relative;
            z-index: 1;
            font-weight: 300;
        }

        /* Section Styling */
        .section {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 40px;
            border: 1px solid rgba(99, 102, 241, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.8s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section:nth-child(2) { animation-delay: 0.2s; }
        .section:nth-child(3) { animation-delay: 0.4s; }
        .section:nth-child(4) { animation-delay: 0.6s; }
        .section:nth-child(5) { animation-delay: 0.8s; }

        .section:hover {
            border-color: rgba(0, 212, 255, 0.6);
            box-shadow: 0 0 40px rgba(0, 212, 255, 0.3);
            transform: translateY(-5px);
        }

        .section-title {
            font-size: 2.5em;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-purple) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 20px;
            font-weight: 700;
        }

        .section-number {
            display: inline-flex;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-purple) 100%);
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: white;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.6);
        }

        /* Toggle Button */
        .toggle-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .toggle-btn {
            padding: 15px 35px;
            background: var(--glass-bg);
            border: 2px solid rgba(0, 212, 255, 0.4);
            border-radius: 12px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            font-weight: 600;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .toggle-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .toggle-btn:hover::before {
            left: 100%;
        }

        .toggle-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--neon-blue);
            box-shadow: 0 0 25px rgba(0, 212, 255, 0.5);
            transform: translateY(-3px);
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-purple) 100%);
            border-color: var(--neon-purple);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.7);
            color: white;
        }

        /* Section 1: Architecture Flow */
        .architecture-flow {
            position: relative;
            padding: 40px 20px;
            min-height: 400px;
        }

        .flow-horizontal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .flow-layer {
            flex: 1;
            min-width: 140px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.15) 0%, rgba(168, 85, 247, 0.1) 100%);
            border: 2px solid rgba(0, 212, 255, 0.5);
            border-radius: 15px;
            padding: 25px 15px;
            text-align: center;
            position: relative;
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .flow-layer:hover {
            transform: scale(1.15) translateY(-10px);
            box-shadow: 0 0 40px rgba(0, 212, 255, 0.6);
            border-color: var(--neon-pink);
            z-index: 10;
        }

        .flow-layer-name {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--neon-blue);
            margin-bottom: 8px;
        }

        .flow-layer-desc {
            font-size: 0.85em;
            color: #9ca3af;
        }

        .flow-arrow {
            font-size: 2em;
            color: var(--neon-purple);
            animation: arrowPulse 1.5s infinite;
            display: flex;
            align-items: center;
        }

        @keyframes arrowPulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .flow-data-packet {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, var(--neon-green) 0%, var(--neon-blue) 100%);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--neon-green);
            animation: flowPacket 4s infinite linear;
        }

        @keyframes flowPacket {
            0% { left: 5%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { left: 95%; opacity: 0; }
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltiptext {
            visibility: hidden;
            background: rgba(15, 23, 42, 0.98);
            color: #e0e0e0;
            text-align: left;
            border-radius: 12px;
            padding: 20px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            width: 320px;
            border: 1px solid var(--neon-blue);
            opacity: 0;
            transition: opacity 0.4s, visibility 0.4s;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .tooltiptext::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -8px;
            border-width: 8px;
            border-style: solid;
            border-color: var(--neon-blue) transparent transparent transparent;
        }

        /* Section 2: PDCP Overview Cards */
        .pdcp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .pdcp-card {
            background: var(--glass-bg);
            border-radius: 18px;
            padding: 30px;
            border: 1px solid rgba(168, 163, 184, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .pdcp-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .pdcp-card:hover::before {
            left: 100%;
        }

        .pdcp-card:hover {
            background: rgba(51, 65, 85, 0.7);
            border-color: var(--neon-blue);
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 212, 255, 0.4);
        }

        .pdcp-card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .pdcp-card-title {
            font-size: 1.5em;
            color: var(--neon-purple);
            margin-bottom: 12px;
            font-weight: 700;
        }

        .pdcp-card-desc {
            color: #9ca3af;
            line-height: 1.7;
            font-size: 0.95em;
        }

        .expand-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(168, 163, 184, 0.3);
        }

        .pdcp-card.expanded .expand-content {
            max-height: 500px;
        }

        .expand-btn {
            margin-top: 15px;
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-purple) 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .expand-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.6);
        }

        /* Section 3: Ciphering Inputs */
        .cipher-pipeline {
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin: 40px 0;
        }

        .input-row {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .cipher-input {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(99, 102, 241, 0.1) 100%);
            border: 2px solid rgba(16, 185, 129, 0.5);
            border-radius: 15px;
            padding: 25px 30px;
            min-width: 200px;
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: all 0.4s ease;
            animation: slideInInput 0.8s ease forwards;
            opacity: 0;
        }

        @keyframes slideInInput {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .cipher-input:nth-child(1) { animation-delay: 0.1s; }
        .cipher-input:nth-child(2) { animation-delay: 0.2s; }
        .cipher-input:nth-child(3) { animation-delay: 0.3s; }
        .cipher-input:nth-child(4) { animation-delay: 0.4s; }
        .cipher-input:nth-child(5) { animation-delay: 0.5s; }

        .cipher-input:hover {
            transform: scale(1.1) translateY(-5px);
            border-color: var(--neon-green);
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.25) 0%, rgba(99, 102, 241, 0.2) 100%);
        }

        .input-label {
            font-size: 0.9em;
            color: var(--neon-green);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .input-value {
            font-size: 1.2em;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-weight: 700;
        }

        .cipher-engine {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(168, 85, 247, 0.2) 100%);
            border: 3px solid var(--neon-pink);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            position: relative;
            overflow: hidden;
            margin: 40px auto;
            max-width: 600px;
            transition: all 0.5s ease;
        }

        .cipher-engine.active {
            box-shadow: 0 0 60px rgba(236, 72, 153, 0.8);
            animation: engineGlow 2s infinite;
        }

        @keyframes engineGlow {
            0%, 100% { box-shadow: 0 0 40px rgba(236, 72, 153, 0.6); }
            50% { box-shadow: 0 0 80px rgba(236, 72, 153, 1); }
        }

        .cipher-engine::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(236, 72, 153, 0.3) 50%, transparent 70%);
            animation: engineSpin 4s infinite linear;
        }

        @keyframes engineSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .engine-title {
            font-size: 2em;
            color: var(--neon-pink);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            font-weight: 700;
        }

        .engine-output {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
            border: 1px solid var(--neon-pink);
        }

        .output-label {
            color: var(--neon-green);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .output-value {
            font-family: 'Courier New', monospace;
            color: #e0e0e0;
            word-break: break-all;
        }

        /* Section 4: Animated Workflow */
        .workflow-container {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            border: 2px solid rgba(0, 212, 255, 0.3);
        }

        .workflow-steps {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 30px 0;
        }

        .workflow-step {
            background: var(--glass-bg);
            border-left: 5px solid var(--neon-blue);
            border-radius: 12px;
            padding: 25px;
            position: relative;
            opacity: 0;
            transform: translateX(-30px);
            transition: all 0.5s ease;
        }

        .workflow-step.animate {
            opacity: 1;
            transform: translateX(0);
            animation: stepHighlight 0.5s ease;
        }

        @keyframes stepHighlight {
            0%, 100% { border-left-color: var(--neon-blue); }
            50% { border-left-color: var(--neon-pink); box-shadow: 0 0 30px rgba(236, 72, 153, 0.6); }
        }

        .step-number {
            display: inline-flex;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-purple) 100%);
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 700;
            color: white;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
        }

        .step-title {
            color: var(--neon-purple);
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 8px;
        }

        .step-desc {
            color: #9ca3af;
            line-height: 1.7;
            margin-left: 55px;
        }

        .control-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 15px 35px;
            background: linear-gradient(135deg, var(--neon-green) 0%, var(--neon-blue) 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
        }

        .control-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.7);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.pause {
            background: linear-gradient(135deg, var(--neon-pink) 0%, var(--neon-purple) 100%);
        }

        .control-btn.reset {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .animated-packet {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, var(--neon-green) 0%, var(--neon-blue) 100%);
            border-radius: 12px;
            position: absolute;
            box-shadow: 0 0 30px var(--neon-green);
            display: none;
            animation: packetMove 3s ease-in-out infinite;
        }

        @keyframes packetMove {
            0%, 100% { top: 0; left: 0; }
            25% { top: 100px; left: 25%; }
            50% { top: 200px; left: 50%; }
            75% { top: 300px; left: 75%; }
        }

        /* Info Popup */
        .info-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(15, 23, 42, 0.98);
            border: 2px solid var(--neon-blue);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            z-index: 2000;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            transition: transform 0.3s ease;
            backdrop-filter: blur(15px);
        }

        .info-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .popup-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2em;
            cursor: pointer;
            color: var(--neon-pink);
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            transform: rotate(90deg);
            color: var(--neon-blue);
        }

        .popup-title {
            font-size: 1.8em;
            color: var(--neon-blue);
            margin-bottom: 20px;
            font-weight: 700;
        }

        .popup-content {
            color: #e0e0e0;
            line-height: 1.8;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        /* Hint Box */
        .hint-box {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid rgba(16, 185, 129, 0.4);
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            position: relative;
            padding-left: 60px;
        }

        .hint-box::before {
            content: 'üí°';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
        }

        .hint-title {
            color: var(--neon-green);
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .hint-text {
            color: #9ca3af;
            line-height: 1.7;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5em;
            }

            .section-title {
                font-size: 1.8em;
            }

            .flow-horizontal {
                flex-direction: column;
            }

            .flow-arrow {
                transform: rotate(90deg);
            }

            .pdcp-grid {
                grid-template-columns: 1fr;
            }

            .cipher-input {
                min-width: 100%;
            }
        }

        /* Code Block Styling */
        .code-block {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--neon-blue);
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            color: var(--neon-green);
            margin: 15px 0;
            overflow-x: auto;
            line-height: 1.6;
        }

        /* Special Effects */
        .glow-text {
            text-shadow: 0 0 10px currentColor;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <!-- Background Particles -->
    <div class="background-particles" id="particles"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <h1>üîê PDCP Ciphering</h1>
            <div class="subtitle">3GPP 4G/5G Protocol Stack Security Visualization</div>
            <div class="subtitle" style="font-size: 0.9em; margin-top: 10px; font-style: italic;">
                Interactive ‚Ä¢ Animated ‚Ä¢ Educational
            </div>
        </header>

        <!-- Section 1: Architecture Flow -->
        <div class="section">
            <h2 class="section-title">
                <span class="section-number">1</span>
                Architecture Flow (End-to-End)
            </h2>

            <div class="toggle-container">
                <button class="toggle-btn active" onclick="switchFlow('tx')">
                    üì§ Transmit View
                </button>
                <button class="toggle-btn" onclick="switchFlow('rx')">
                    üì• Receive View
                </button>
            </div>

            <div class="architecture-flow" id="tx-flow">
                <h3 style="text-align: center; color: var(--neon-blue); margin-bottom: 30px; font-size: 1.5em;">
                    Transmitter Path: Application ‚Üí Air Interface
                </h3>
                <div class="flow-horizontal">
                    <div class="flow-layer tooltip">
                        <div class="flow-layer-name">Application</div>
                        <div class="flow-layer-desc">User Data</div>
                        <span class="tooltiptext">
                            <strong>Application Layer</strong><br><br>
                            ‚Ä¢ Generates user data (web, video, voice)<br>
                            ‚Ä¢ Creates IP packets<br>
                            ‚Ä¢ Hands off to PDCP layer<br>
                            ‚Ä¢ Examples: HTTP, VoIP, Streaming
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip" style="border-color: var(--neon-pink);">
                        <div class="flow-layer-name" style="color: var(--neon-pink);">PDCP</div>
                        <div class="flow-layer-desc">Cipher + Compress</div>
                        <span class="tooltiptext">
                            <strong>PDCP Layer</strong><br><br>
                            ‚úì Header compression (ROHC)<br>
                            ‚úì <strong>Ciphering (Encryption)</strong><br>
                            ‚úì Integrity protection<br>
                            ‚úì Sequence numbering
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip">
                        <div class="flow-layer-name">RLC</div>
                        <div class="flow-layer-desc">Segmentation</div>
                        <span class="tooltiptext">
                            <strong>RLC Layer</strong><br><br>
                            ‚Ä¢ Segments PDCP PDUs<br>
                            ‚Ä¢ ARQ (retransmission)<br>
                            ‚Ä¢ Reordering<br>
                            ‚Ä¢ Modes: TM, UM, AM
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip">
                        <div class="flow-layer-name">MAC</div>
                        <div class="flow-layer-desc">Scheduling</div>
                        <span class="tooltiptext">
                            <strong>MAC Layer</strong><br><br>
                            ‚Ä¢ Multiplexing of logical channels<br>
                            ‚Ä¢ Scheduling and priority handling<br>
                            ‚Ä¢ HARQ retransmissions<br>
                            ‚Ä¢ Resource allocation
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip">
                        <div class="flow-layer-name">PHY</div>
                        <div class="flow-layer-desc">Modulation</div>
                        <span class="tooltiptext">
                            <strong>Physical Layer</strong><br><br>
                            ‚Ä¢ Channel coding<br>
                            ‚Ä¢ Modulation (QPSK, QAM)<br>
                            ‚Ä¢ MIMO processing<br>
                            ‚Ä¢ RF transmission
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(168, 85, 247, 0.15) 100%);">
                        <div class="flow-layer-name">üì° Air</div>
                        <div class="flow-layer-desc">Radio Waves</div>
                        <span class="tooltiptext">
                            <strong>Air Interface</strong><br><br>
                            ‚Ä¢ Wireless transmission<br>
                            ‚Ä¢ Over the air propagation<br>
                            ‚Ä¢ Subject to interference<br>
                            ‚Ä¢ Channel fading
                        </span>
                    </div>
                </div>
                <div style="position: relative; height: 40px; margin-top: 20px;">
                    <div class="flow-data-packet"></div>
                </div>
            </div>

            <div class="architecture-flow" id="rx-flow" style="display: none;">
                <h3 style="text-align: center; color: var(--neon-purple); margin-bottom: 30px; font-size: 1.5em;">
                    Receiver Path: Air Interface ‚Üí Application
                </h3>
                <div class="flow-horizontal">
                    <div class="flow-layer tooltip" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(168, 85, 247, 0.15) 100%);">
                        <div class="flow-layer-name">üì° Air</div>
                        <div class="flow-layer-desc">Radio Waves</div>
                        <span class="tooltiptext">
                            <strong>Air Interface</strong><br><br>
                            ‚Ä¢ Receives radio signals<br>
                            ‚Ä¢ Antenna reception<br>
                            ‚Ä¢ Signal detection
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip">
                        <div class="flow-layer-name">PHY</div>
                        <div class="flow-layer-desc">Demodulation</div>
                        <span class="tooltiptext">
                            <strong>Physical Layer</strong><br><br>
                            ‚Ä¢ Demodulation<br>
                            ‚Ä¢ Channel decoding<br>
                            ‚Ä¢ Error correction<br>
                            ‚Ä¢ Symbol detection
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip">
                        <div class="flow-layer-name">MAC</div>
                        <div class="flow-layer-desc">Demultiplexing</div>
                        <span class="tooltiptext">
                            <strong>MAC Layer</strong><br><br>
                            ‚Ä¢ Demultiplexing<br>
                            ‚Ä¢ HARQ combining<br>
                            ‚Ä¢ Channel identification<br>
                            ‚Ä¢ Priority handling
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip">
                        <div class="flow-layer-name">RLC</div>
                        <div class="flow-layer-desc">Reassembly</div>
                        <span class="tooltiptext">
                            <strong>RLC Layer</strong><br><br>
                            ‚Ä¢ Reassembles segments<br>
                            ‚Ä¢ Reordering<br>
                            ‚Ä¢ Duplicate detection<br>
                            ‚Ä¢ Delivers to PDCP
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip" style="border-color: var(--neon-pink);">
                        <div class="flow-layer-name" style="color: var(--neon-pink);">PDCP</div>
                        <div class="flow-layer-desc">Decipher + Decompress</div>
                        <span class="tooltiptext">
                            <strong>PDCP Layer</strong><br><br>
                            ‚úì <strong>Deciphering (Decryption)</strong><br>
                            ‚úì Integrity verification<br>
                            ‚úì Header decompression<br>
                            ‚úì Duplicate detection
                        </span>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-layer tooltip">
                        <div class="flow-layer-name">Application</div>
                        <div class="flow-layer-desc">User Data</div>
                        <span class="tooltiptext">
                            <strong>Application Layer</strong><br><br>
                            ‚Ä¢ Receives decrypted data<br>
                            ‚Ä¢ Delivers to application<br>
                            ‚Ä¢ User sees content<br>
                            ‚Ä¢ End-to-end delivery
                        </span>
                    </div>
                </div>
                <div style="position: relative; height: 40px; margin-top: 20px;">
                    <div class="flow-data-packet"></div>
                </div>
            </div>

            <div class="hint-box">
                <div class="hint-title">What is happening here?</div>
                <div class="hint-text">
                    Data flows through multiple protocol layers. The <strong>PDCP layer</strong> is where encryption happens!
                    On the transmit side, data gets encrypted before going over the air. On the receive side, 
                    data gets decrypted after reception.
                </div>
            </div>
        </div>

        <!-- Section 2: PDCP Overview -->
        <div class="section">
            <h2 class="section-title">
                <span class="section-number">2</span>
                PDCP Layer Overview
            </h2>

            <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 30px; color: #9ca3af;">
                The <strong style="color: var(--neon-blue);">Packet Data Convergence Protocol (PDCP)</strong> is a crucial 
                layer in the 4G/5G protocol stack responsible for security, efficiency, and reliability of data transmission.
            </p>

            <div class="pdcp-grid">
                <div class="pdcp-card" onclick="toggleCard(this)">
                    <span class="pdcp-card-icon">üéØ</span>
                    <div class="pdcp-card-title">Role in 4G/5G</div>
                    <div class="pdcp-card-desc">
                        Ensures secure and efficient data transfer between UE and network
                    </div>
                    <div class="expand-content">
                        <ul style="margin-left: 20px; line-height: 2; color: #d1d5db;">
                            <li>Sits between IP layer and RLC layer</li>
                            <li>Handles both user plane and control plane</li>
                            <li>Critical for 5G high-speed transmission</li>
                            <li>Operates per radio bearer</li>
                        </ul>
                    </div>
                    <button class="expand-btn">Learn More</button>
                </div>

                <div class="pdcp-card" onclick="toggleCard(this)">
                    <span class="pdcp-card-icon">üóúÔ∏è</span>
                    <div class="pdcp-card-title">Header Compression</div>
                    <div class="pdcp-card-desc">
                        Reduces overhead using ROHC (Robust Header Compression)
                    </div>
                    <div class="expand-content">
                        <ul style="margin-left: 20px; line-height: 2; color: #d1d5db;">
                            <li>Compresses IP/UDP/RTP headers</li>
                            <li>Saves bandwidth on air interface</li>
                            <li>Essential for VoIP and streaming</li>
                            <li>Context-based compression</li>
                        </ul>
                    </div>
                    <button class="expand-btn">Learn More</button>
                </div>

                <div class="pdcp-card" onclick="toggleCard(this)">
                    <span class="pdcp-card-icon">üîê</span>
                    <div class="pdcp-card-title">Ciphering</div>
                    <div class="pdcp-card-desc">
                        Encrypts user data and signaling for confidentiality
                    </div>
                    <div class="expand-content">
                        <ul style="margin-left: 20px; line-height: 2; color: #d1d5db;">
                            <li>Uses AES, SNOW 3G, or ZUC algorithms</li>
                            <li>Protects against eavesdropping</li>
                            <li>Separate keys for UP and CP</li>
                            <li>COUNT-based keystream generation</li>
                        </ul>
                    </div>
                    <button class="expand-btn">Learn More</button>
                </div>

                <div class="pdcp-card" onclick="toggleCard(this)">
                    <span class="pdcp-card-icon">‚úÖ</span>
                    <div class="pdcp-card-title">Integrity Protection</div>
                    <div class="pdcp-card-desc">
                        Verifies data hasn't been tampered with during transmission
                    </div>
                    <div class="expand-content">
                        <ul style="margin-left: 20px; line-height: 2; color: #d1d5db;">
                            <li>Uses MAC-I (Message Authentication Code)</li>
                            <li>Detects unauthorized modifications</li>
                            <li>Mandatory for control plane</li>
                            <li>Optional for user plane</li>
                        </ul>
                    </div>
                    <button class="expand-btn">Learn More</button>
                </div>

                <div class="pdcp-card" onclick="toggleCard(this)">
                    <span class="pdcp-card-icon">üîÑ</span>
                    <div class="pdcp-card-title">Reordering</div>
                    <div class="pdcp-card-desc">
                        Delivers packets in correct sequence to upper layers
                    </div>
                    <div class="expand-content">
                        <ul style="margin-left: 20px; line-height: 2; color: #d1d5db;">
                            <li>Uses PDCP sequence numbers</li>
                            <li>Handles out-of-order delivery from RLC</li>
                            <li>Implements reordering timer</li>
                            <li>Ensures in-sequence delivery</li>
                        </ul>
                    </div>
                    <button class="expand-btn">Learn More</button>
                </div>

                <div class="pdcp-card" onclick="toggleCard(this)">
                    <span class="pdcp-card-icon">üö´</span>
                    <div class="pdcp-card-title">Duplicate Detection</div>
                    <div class="pdcp-card-desc">
                        Discards duplicate packets to prevent processing overhead
                    </div>
                    <div class="expand-content">
                        <ul style="margin-left: 20px; line-height: 2; color: #d1d5db;">
                            <li>Tracks received sequence numbers</li>
                            <li>Detects retransmitted duplicates</li>
                            <li>Prevents unnecessary processing</li>
                            <li>Maintains reception window</li>
                        </ul>
                    </div>
                    <button class="expand-btn">Learn More</button>
                </div>
            </div>

            <div class="hint-box" style="margin-top: 30px;">
                <div class="hint-title">What is happening here?</div>
                <div class="hint-text">
                    PDCP performs multiple critical functions. <strong>Ciphering</strong> is the most important security feature,
                    ensuring your data remains private. Click "Learn More" on any card to see detailed information!
                </div>
            </div>
        </div>

        <!-- Section 3: Ciphering Inputs -->
        <div class="section">
            <h2 class="section-title">
                <span class="section-number">3</span>
                Ciphering Inputs (3GPP Standard)
            </h2>

            <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 30px; color: #9ca3af;">
                PDCP ciphering requires <strong style="color: var(--neon-green);">five key inputs</strong> to generate 
                a unique keystream for each packet. These inputs ensure security and prevent replay attacks.
            </p>

            <div class="cipher-pipeline">
                <div class="input-row">
                    <div class="cipher-input tooltip" onclick="showInputInfo('key')">
                        <div class="input-label">üîë Ciphering Key</div>
                        <div class="input-value">K_UPenc / K_RRCenc</div>
                        <span class="tooltiptext">
                            <strong>Ciphering Key (128/256-bit)</strong><br><br>
                            ‚Ä¢ Derived from security context<br>
                            ‚Ä¢ K_UPenc: User plane data<br>
                            ‚Ä¢ K_RRCenc: Control plane (RRC)<br>
                            ‚Ä¢ Never transmitted over air<br>
                            ‚Ä¢ Unique per UE session
                        </span>
                    </div>

                    <div class="cipher-input tooltip" onclick="showInputInfo('count')">
                        <div class="input-label">üî¢ COUNT Value</div>
                        <div class="input-value">HFN + PDCP SN</div>
                        <span class="tooltiptext">
                            <strong>COUNT (32-bit)</strong><br><br>
                            ‚Ä¢ HFN: Hyper Frame Number (20 bits)<br>
                            ‚Ä¢ PDCP SN: Sequence Number (12 bits)<br>
                            ‚Ä¢ Increments for each packet<br>
                            ‚Ä¢ Ensures unique keystream<br>
                            ‚Ä¢ Synchronized between TX/RX
                        </span>
                    </div>

                    <div class="cipher-input tooltip" onclick="showInputInfo('bearer')">
                        <div class="input-label">üéØ Bearer ID</div>
                        <div class="input-value">0 - 31</div>
                        <span class="tooltiptext">
                            <strong>Radio Bearer Identifier</strong><br><br>
                            ‚Ä¢ Identifies specific radio bearer<br>
                            ‚Ä¢ SRB: Signaling (0-2)<br>
                            ‚Ä¢ DRB: Data (1-32)<br>
                            ‚Ä¢ Each bearer independent<br>
                            ‚Ä¢ Part of security domain separation
                        </span>
                    </div>

                    <div class="cipher-input tooltip" onclick="showInputInfo('direction')">
                        <div class="input-label">‚ÜïÔ∏è Direction</div>
                        <div class="input-value">UL (0) / DL (1)</div>
                        <span class="tooltiptext">
                            <strong>Direction Bit</strong><br><br>
                            ‚Ä¢ Uplink (UE‚ÜígNB): 0<br>
                            ‚Ä¢ Downlink (gNB‚ÜíUE): 1<br>
                            ‚Ä¢ Different keystreams for UL/DL<br>
                            ‚Ä¢ Prevents reflection attacks<br>
                            ‚Ä¢ Part of cipher input
                        </span>
                    </div>

                    <div class="cipher-input tooltip" onclick="showInputInfo('algorithm')">
                        <div class="input-label">üîê Algorithm</div>
                        <div class="input-value" id="algo-display">AES</div>
                        <span class="tooltiptext">
                            <strong>Ciphering Algorithm</strong><br><br>
                            ‚Ä¢ <strong>AES:</strong> NIST standard<br>
                            ‚Ä¢ <strong>SNOW 3G:</strong> 3GPP heritage<br>
                            ‚Ä¢ <strong>ZUC:</strong> 5G optimized<br>
                            ‚Ä¢ Negotiated during setup<br>
                            ‚Ä¢ Hardware accelerated
                        </span>
                    </div>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 3em; color: var(--neon-purple); animation: arrowPulse 1.5s infinite;">
                        ‚¨áÔ∏è
                    </div>
                    <div style="color: var(--neon-green); font-size: 1.2em; font-weight: 600; margin: 10px 0;">
                        All inputs feed into...
                    </div>
                </div>

                <div class="cipher-engine" id="cipher-engine">
                    <div class="engine-title">üîÆ Cipher Engine</div>
                    <div style="position: relative; z-index: 1;">
                        <div style="font-size: 1.2em; color: #9ca3af; margin: 20px 0;">
                            Processing inputs to generate keystream...
                        </div>
                        <button class="control-btn" onclick="activateCipherEngine()" style="margin: 20px 0;">
                            ‚ñ∂Ô∏è Activate Engine
                        </button>
                    </div>
                    <div class="engine-output">
                        <div class="output-label">üì¶ Output: Keystream</div>
                        <div class="output-value" id="keystream-output">
                            Click "Activate Engine" to generate keystream
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 3em; color: var(--neon-purple); animation: arrowPulse 1.5s infinite;">
                        ‚¨áÔ∏è
                    </div>
                    <div style="color: var(--neon-pink); font-size: 1.2em; font-weight: 600; margin: 10px 0;">
                        XOR with plaintext
                    </div>
                </div>

                <div class="code-block">
                    Ciphered_Data = Plaintext_Data ‚äï Keystream
                </div>
            </div>

            <div class="hint-box">
                <div class="hint-title">What is happening here?</div>
                <div class="hint-text">
                    The cipher engine takes five inputs and generates a <strong>keystream</strong>. This keystream is 
                    then XORed with the plaintext to create encrypted data. The same process in reverse decrypts the data!
                    Click on any input to learn more about it.
                </div>
            </div>
        </div>

        <!-- Section 4: Animated Workflow -->
        <div class="section">
            <h2 class="section-title">
                <span class="section-number">4</span>
                Message Flow + Workflow (Animated)
            </h2>

            <div class="toggle-container">
                <button class="toggle-btn active" onclick="switchWorkflow('tx-workflow')">
                    üì§ TX Side (Encryption)
                </button>
                <button class="toggle-btn" onclick="switchWorkflow('rx-workflow')">
                    üì• RX Side (Decryption)
                </button>
            </div>

            <div class="workflow-container" id="tx-workflow">
                <h3 style="text-align: center; color: var(--neon-blue); margin-bottom: 30px; font-size: 1.6em;">
                    Transmitter: Encryption Workflow
                </h3>

                <div class="workflow-steps" id="tx-steps">
                    <div class="workflow-step">
                        <span class="step-number">1</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Application ‚Üí PDCP: SDU Reception</div>
                            <div class="step-desc">
                                PDCP receives a Service Data Unit (SDU) from the upper layer. This could be an IP packet 
                                (user plane) or an RRC message (control plane).
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">2</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Form PDCP Header</div>
                            <div class="step-desc">
                                PDCP creates a header containing the Sequence Number (SN). The header format depends on 
                                whether it's 12-bit or 18-bit SN configuration.
                                <div class="code-block" style="margin-top: 10px; font-size: 0.9em;">
[D/C | SN] where D/C=1 for data, SN = current sequence number
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">3</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Generate COUNT Value</div>
                            <div class="step-desc">
                                Construct 32-bit COUNT by combining HFN and PDCP SN. This ensures each packet gets a unique identifier.
                                <div class="code-block" style="margin-top: 10px; font-size: 0.9em;">
COUNT = (HFN << 12) | PDCP_SN
Example: HFN=0x00AB, SN=0x234 ‚Üí COUNT=0x00AB234
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">4</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Feed Inputs to Cipher Engine</div>
                            <div class="step-desc">
                                All five inputs (KEY, COUNT, BEARER, DIRECTION, ALGORITHM) are fed into the ciphering algorithm 
                                to generate the keystream. The keystream length matches the data length.
                                <div class="code-block" style="margin-top: 10px; font-size: 0.9em;">
Keystream = CIPHER(K_enc, COUNT, BEARER, DIR, LENGTH)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">5</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Encrypt: XOR Operation</div>
                            <div class="step-desc">
                                The plaintext data is XORed with the keystream to produce ciphered data. Note: Only the 
                                payload is encrypted, not the PDCP header!
                                <div class="code-block" style="margin-top: 10px; font-size: 0.9em;">
Ciphered_Payload = Plaintext_Payload ‚äï Keystream
Final PDU = [PDCP Header] + [Ciphered Payload]
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">6</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">PDCP ‚Üí RLC: Deliver PDU</div>
                            <div class="step-desc">
                                The complete PDCP PDU (header + ciphered payload) is handed to the RLC layer for further 
                                processing. RLC treats it as opaque data and doesn't know it's encrypted.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-panel">
                    <button class="control-btn" onclick="animateWorkflow('tx')">
                        ‚ñ∂Ô∏è Play Animation
                    </button>
                    <button class="control-btn pause" onclick="pauseWorkflow()">
                        ‚è∏Ô∏è Pause
                    </button>
                    <button class="control-btn reset" onclick="resetWorkflow()">
                        üîÑ Reset
                    </button>
                </div>
            </div>

            <div class="workflow-container" id="rx-workflow" style="display: none;">
                <h3 style="text-align: center; color: var(--neon-purple); margin-bottom: 30px; font-size: 1.6em;">
                    Receiver: Decryption Workflow
                </h3>

                <div class="workflow-steps" id="rx-steps">
                    <div class="workflow-step">
                        <span class="step-number">1</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">RLC ‚Üí PDCP: Receive PDU</div>
                            <div class="step-desc">
                                PDCP receives the reassembled PDU from RLC layer. The PDU contains a plaintext header and 
                                ciphered payload.
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">2</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Extract COUNT from Header</div>
                            <div class="step-desc">
                                Parse the PDCP header to extract the Sequence Number (SN). Combine with locally maintained 
                                HFN to reconstruct the full COUNT value.
                                <div class="code-block" style="margin-top: 10px; font-size: 0.9em;">
Received_SN = parse_header(PDCP_PDU)
COUNT = (RX_HFN << 12) | Received_SN
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">3</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Use Same Key + Inputs</div>
                            <div class="step-desc">
                                The receiver uses the same ciphering key (shared during security setup) and reconstructed 
                                COUNT, along with BEARER ID and DIRECTION bit.
                                <div class="code-block" style="margin-top: 10px; font-size: 0.9em;">
Inputs: Same K_enc, reconstructed COUNT, BEARER, DIR
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">4</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Generate Identical Keystream</div>
                            <div class="step-desc">
                                Run the same ciphering algorithm with identical inputs to generate the exact same keystream 
                                that was used for encryption.
                                <div class="code-block" style="margin-top: 10px; font-size: 0.9em;">
Keystream = CIPHER(K_enc, COUNT, BEARER, DIR, LENGTH)
(Must match TX keystream exactly!)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">5</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">Decrypt: XOR Operation</div>
                            <div class="step-desc">
                                XOR the ciphered payload with the keystream to recover the original plaintext. XOR is 
                                self-inverse, so encryption and decryption use the same operation!
                                <div class="code-block" style="margin-top: 10px; font-size: 0.9em;">
Plaintext_Payload = Ciphered_Payload ‚äï Keystream
(Because: (P ‚äï K) ‚äï K = P)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="workflow-step">
                        <span class="step-number">6</span>
                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 60px);">
                            <div class="step-title">PDCP ‚Üí Application: Deliver SDU</div>
                            <div class="step-desc">
                                Remove the PDCP header and deliver the decrypted SDU (IP packet or RRC message) to the 
                                upper layer application. Mission complete! üéâ
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-panel">
                    <button class="control-btn" onclick="animateWorkflow('rx')">
                        ‚ñ∂Ô∏è Play Animation
                    </button>
                    <button class="control-btn pause" onclick="pauseWorkflow()">
                        ‚è∏Ô∏è Pause
                    </button>
                    <button class="control-btn reset" onclick="resetWorkflow()">
                        üîÑ Reset
                    </button>
                </div>
            </div>

            <div class="hint-box" style="margin-top: 30px;">
                <div class="hint-title">What is happening here?</div>
                <div class="hint-text">
                    The TX side encrypts data step by step, while the RX side reverses the process to decrypt. 
                    The key insight: <strong>both sides must have synchronized COUNT values and the same key</strong> 
                    to generate matching keystreams. Click "Play Animation" to see the steps highlight in sequence!
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer style="text-align: center; padding: 40px 20px; color: #6b7280; margin-top: 40px;">
            <p style="font-size: 1.1em;">üî¨ Interactive PDCP Ciphering Visualization</p>
            <p style="margin-top: 10px;">3GPP Standards ‚Ä¢ 4G LTE ‚Ä¢ 5G NR</p>
            <p style="margin-top: 15px; font-size: 0.9em; font-style: italic;">
                Hover over any element for detailed explanations ‚Ä¢ Click buttons to see animations
            </p>
        </footer>
    </div>

    <!-- Info Popup -->
    <div class="overlay" id="overlay" onclick="closePopup()"></div>
    <div class="info-popup" id="info-popup">
        <span class="popup-close" onclick="closePopup()">√ó</span>
        <div class="popup-title" id="popup-title">Information</div>
        <div class="popup-content" id="popup-content"></div>
    </div>

    <script>
        // Create background particles
        function createParticles() {
            const container = document.getElementById('particles');
            const colors = ['#00d4ff', '#a855f7', '#ec4899', '#10b981'];
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        // Switch between TX and RX flow
        function switchFlow(flow) {
            const buttons = document.querySelectorAll('.toggle-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (flow === 'tx') {
                document.getElementById('tx-flow').style.display = 'block';
                document.getElementById('rx-flow').style.display = 'none';
            } else {
                document.getElementById('tx-flow').style.display = 'none';
                document.getElementById('rx-flow').style.display = 'block';
            }
        }

        // Toggle PDCP card expansion
        function toggleCard(card) {
            card.classList.toggle('expanded');
            const btn = card.querySelector('.expand-btn');
            if (card.classList.contains('expanded')) {
                btn.textContent = 'Show Less';
            } else {
                btn.textContent = 'Learn More';
            }
        }

        // Show input information popup
        function showInputInfo(inputType) {
            const popup = document.getElementById('info-popup');
            const overlay = document.getElementById('overlay');
            const title = document.getElementById('popup-title');
            const content = document.getElementById('popup-content');

            const infoData = {
                'key': {
                    title: 'üîë Ciphering Key',
                    content: `
                        <h4 style="color: var(--neon-blue); margin-bottom: 15px;">Key Derivation</h4>
                        <p style="line-height: 1.8; margin-bottom: 15px;">
                            The ciphering key is derived from the base security context established during 
                            authentication and key agreement (AKA) procedure.
                        </p>
                        <ul style="margin-left: 20px; line-height: 2;">
                            <li><strong>LTE:</strong> Derived from Kasme (Access Security Management Entity key)</li>
                            <li><strong>5G:</strong> Derived from Kgn (gNB key)</li>
                            <li><strong>K_UPenc:</strong> Used for user plane data encryption</li>
                            <li><strong>K_RRCenc:</strong> Used for RRC signaling encryption</li>
                        </ul>
                        <div class="code-block" style="margin-top: 15px;">
K_enc = KDF(K_base, algorithm_id, ...)
Key Length: 128 or 256 bits
                        </div>
                    `
                },
                'count': {
                    title: 'üî¢ COUNT Value',
                    content: `
                        <h4 style="color: var(--neon-blue); margin-bottom: 15px;">COUNT Structure</h4>
                        <p style="line-height: 1.8; margin-bottom: 15px;">
                            COUNT is a 32-bit value formed by concatenating HFN and PDCP SN. It ensures 
                            each packet gets a unique keystream.
                        </p>
                        <div class="code-block">
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  HFN (20 bits)  ‚îÇ PDCP SN (12) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        32 bits total

Example:
HFN = 0x000AB (171 decimal)
SN  = 0x234 (564 decimal)
COUNT = 0x00AB234
                        </div>
                        <p style="margin-top: 15px; line-height: 1.8;">
                            <strong>Key Points:</strong>
                        </p>
                        <ul style="margin-left: 20px; line-height: 2;">
                            <li>HFN increments when SN wraps around (reaches maximum)</li>
                            <li>Both TX and RX must maintain synchronized COUNT</li>
                            <li>COUNT never repeats for the same bearer</li>
                            <li>Prevents replay attacks</li>
                        </ul>
                    `
                },
                'bearer': {
                    title: 'üéØ Bearer ID',
                    content: `
                        <h4 style="color: var(--neon-blue); margin-bottom: 15px;">Radio Bearer Types</h4>
                        <p style="line-height: 1.8; margin-bottom: 15px;">
                            Each radio bearer has its own security context and independent COUNT value.
                        </p>
                        <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                            <tr style="background: rgba(0, 212, 255, 0.1);">
                                <th style="padding: 10px; text-align: left; border: 1px solid rgba(0, 212, 255, 0.3);">Bearer Type</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid rgba(0, 212, 255, 0.3);">ID Range</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid rgba(0, 212, 255, 0.3);">Purpose</th>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">SRB0</td>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">0</td>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">Initial setup (not ciphered)</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">SRB1-2</td>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">1-2</td>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">RRC signaling</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">DRB</td>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">1-32</td>
                                <td style="padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">User data</td>
                            </tr>
                        </table>
                    `
                },
                'direction': {
                    title: '‚ÜïÔ∏è Direction Bit',
                    content: `
                        <h4 style="color: var(--neon-blue); margin-bottom: 15px;">Why Direction Matters</h4>
                        <p style="line-height: 1.8; margin-bottom: 15px;">
                            The direction bit ensures that uplink and downlink transmissions use different 
                            keystreams, even with the same COUNT value.
                        </p>
                        <div class="code-block">
Uplink (UE ‚Üí gNB):   DIRECTION = 0
Downlink (gNB ‚Üí UE): DIRECTION = 1

Security Benefit:
Prevents reflection attacks where an 
attacker might try to replay captured 
downlink data as uplink.
                        </div>
                        <p style="margin-top: 15px; line-height: 1.8;">
                            <strong>Example:</strong><br>
                            Even if UL and DL have same COUNT=100, BEARER=5, the different DIRECTION 
                            values ensure completely different keystreams are generated.
                        </p>
                    `
                },
                'algorithm': {
                    title: 'üîê Ciphering Algorithms',
                    content: `
                        <h4 style="color: var(--neon-blue); margin-bottom: 15px;">Supported Algorithms</h4>
                        <p style="line-height: 1.8; margin-bottom: 15px;">
                            3GPP supports three main ciphering algorithms, negotiated during security mode setup.
                        </p>
                        <div style="margin: 20px 0;">
                            <h5 style="color: var(--neon-green); margin-bottom: 10px;">üîπ AES (Advanced Encryption Standard)</h5>
                            <ul style="margin-left: 20px; line-height: 2;">
                                <li>NIST approved block cipher</li>
                                <li>Supports 128 and 256-bit keys</li>
                                <li>Used in CTR (Counter) mode</li>
                                <li>Excellent hardware support</li>
                            </ul>
                        </div>
                        <div style="margin: 20px 0;">
                            <h5 style="color: var(--neon-green); margin-bottom: 10px;">üîπ SNOW 3G</h5>
                            <ul style="margin-left: 20px; line-height: 2;">
                                <li>Stream cipher from 3GPP</li>
                                <li>Heritage from 3G/4G</li>
                                <li>128-bit key</li>
                                <li>Optimized for telecom</li>
                            </ul>
                        </div>
                        <div style="margin: 20px 0;">
                            <h5 style="color: var(--neon-green); margin-bottom: 10px;">üîπ ZUC</h5>
                            <ul style="margin-left: 20px; line-height: 2;">
                                <li>Chinese standard (GB)</li>
                                <li>Stream cipher</li>
                                <li>5G optimized performance</li>
                                <li>128 and 256-bit variants</li>
                            </ul>
                        </div>
                    `
                }
            };

            const data = infoData[inputType];
            title.textContent = data.title;
            content.innerHTML = data.content;

            popup.classList.add('show');
            overlay.classList.add('show');
        }

        // Close popup
        function closePopup() {
            document.getElementById('info-popup').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        // Activate cipher engine animation
        function activateCipherEngine() {
            const engine = document.getElementById('cipher-engine');
            const output = document.getElementById('keystream-output');
            
            engine.classList.add('active');
            
            // Simulate keystream generation
            let counter = 0;
            const interval = setInterval(() => {
                const randomBytes = Array.from({length: 16}, () => 
                    Math.floor(Math.random() * 256).toString(16).padStart(2, '0')
                ).join(' ');
                
                output.textContent = randomBytes.toUpperCase();
                counter++;
                
                if (counter >= 3) {
                    clearInterval(interval);
                    setTimeout(() => {
                        output.textContent = 'A3 F2 8B 1C 9D 4E 7F 2A 5B 8C 3D 6E 9F 0A 1B 2C';
                        engine.classList.remove('active');
                    }, 500);
                }
            }, 400);
        }

        // Switch workflow view
        function switchWorkflow(workflow) {
            const buttons = document.querySelectorAll('.toggle-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (workflow === 'tx-workflow') {
                document.getElementById('tx-workflow').style.display = 'block';
                document.getElementById('rx-workflow').style.display = 'none';
            } else {
                document.getElementById('tx-workflow').style.display = 'none';
                document.getElementById('rx-workflow').style.display = 'block';
            }
        }

        // Animation state
        let animationInterval = null;

        // Animate workflow
        function animateWorkflow(side) {
            resetWorkflow();
            
            const stepsId = side === 'tx' ? 'tx-steps' : 'rx-steps';
            const steps = document.querySelectorAll(`#${stepsId} .workflow-step`);
            
            let currentStep = 0;
            
            animationInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    steps[currentStep].classList.add('animate');
                    currentStep++;
                } else {
                    clearInterval(animationInterval);
                }
            }, 1000);
        }

        // Pause workflow animation
        function pauseWorkflow() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
        }

        // Reset workflow animation
        function resetWorkflow() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
            
            const allSteps = document.querySelectorAll('.workflow-step');
            allSteps.forEach(step => {
                step.classList.remove('animate');
            });
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            createParticles();
        });

        // Prevent default behavior for demo buttons
        document.addEventListener('DOMContentLoaded', () => {
            // Add smooth scrolling
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
